<!DOCTYPE HTML>
<html>
<head>
    <title>Final Judgement</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="keywords" content="Gato Responsive web template, Bootstrap Web Templates, Flat Web Templates, Andriod Compatible web template,
Smartphone Compatible web template, free webdesigns for Nokia, Samsung, LG, SonyErricsson, Motorola web design" />
    <script type="application/x-javascript"> addEventListener("load", function() { setTimeout(hideURLbar, 0); }, false); function hideURLbar(){ window.scrollTo(0,1); } </script>
    <link href="css/bootstrap.css" rel='stylesheet' type='text/css' />
    <!-- Custom Theme files -->
    <link href="css/style.css" rel='stylesheet' type='text/css' />
    <link href="css/myCss.css" rel='stylesheet' type='text/css' />
    <script src="js/jquery-2.2.3.min.js"> </script>
    <script src="js/bootstrap.min.js"> </script>
</head>
<body>
<!--start-home-->
<div id="home" class="header">
    <div class="header-bottom">
        <div class="container">
            <div class="logo">
                <a href=""><h1>Paper<span>_System</span></h1></a>
            </div>
            <span class="menu"></span>
            <div class="top-menu">
                <ul>
                    <nav>
                        <li><a href="viewPaper.html">查阅论文</a></li>
                        <li><a href="chairman.html">分配任务</a></li>
                        <li><a href="finalJudgement.html">终审</a></li>
                        <li><a href="privilegeManagement.html">权限管理</a></li>
                        <li><a href="login.html">退出</a></li>
                    </nav>
                </ul>
            </div>

            <!-- script for menu -->
            <div class="clearfix"></div>
        </div>
    </div>

    <div class="banner two">
        <div class="container">
            <div class="pag-nav">
                <ul class="p-list">

                </ul>
            </div>
        </div>
    </div>
</div>
<!--error-->

<div class="contact" id="finalJudgement">

</div>
<div class="contact" id="modalpos">
    <div class="modal fade" id="myModal" tabindex="-1" role="dialog"
         aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">x</button>
                </div>
                <div class="modal-body">
                    <table align="center">
                        <tr><h2>是否通过审批？</h2></tr>
                        <br>
                        <tr id="FinalJudgeBtn">

                        </tr>
                    </table>
                </div>
                <div class="modal-footer" id="modal-footer">

                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->';
</div>

<script type="text/javascript">
    $(document).ready(function(){
        finalJudgementPage();
    })

    function showPaperInfo(data, flag, tagID) {
        var content = '';
        var paperMsg = "作者: " + data.author + "  提交时间: " + data.submittime + "  关键词: ";

        $.ajax({
            url: "http://202.120.40.73:28080/Entity/Ubfca480238c858/PaperRev/Keywords/?Keywords.match.id="+data.id,
            type: "GET",
            async: false,
            success: function (keywordsdata) {
                var keywords = eval(keywordsdata);

                if (!jQuery.isEmptyObject(keywords)) {
                    for (var i = 0; i < keywords.Keywords.length; i++) {
                        paperMsg += keywords.Keywords[i].word;
                    }
                }

                if (flag % 2 == 0) {
                    content += '<div class="container" style="background: #d9d9d9;">\
                                    <div class="mytext">\
                                        <textarea class="myTitleText myTitleTextAdd myTextArea" style="background: #d9d9d9;" \
                                            onclick="ShowPaperClick(' + data.id + ')">' + data.title + '</textarea> \
                                        <h1 class="myMsgText">'+paperMsg+'</h1>\
                                    </div>';
                }
                else {
                    content += '<div class="container" style="background: #f0f0f0;">\
                                    <div class="mytext">\
                                        <textarea class="myTitleText myTitleTextAdd myTextArea" style="background: #f0f0f0;" \
                                            onclick="ShowPaperClick(' + data.id + ')">' + data.title + '</textarea> \
                                        <h1 class="myMsgText">'+paperMsg+'</h1>\
                                    </div>';
                }
                content += '<div>\
                        <input type="button" class="mybutton" value="审批" onclick="judgeClick(' + data.id + ')">\
                        <input type="button" class="mybutton" value="查看意见" onclick="checkAdviceClick(' + data.id + ')">\
                    </div>\
                </div>';

                $(tagID).append(content);
                $(tagID).show('slow');
            }
        });
    }
</script>

<script type="text/javascript">
    function finalJudgementPage() {
        var username = localStorage.getItem("name");
        var role = localStorage.getItem("role");

        var content = '<div class="container">\
                            <div class="contact-main">\
                                <h1 class="myheadText" style="font-size:30px">论文名</h1>\
                                <h1 class="myheadLabel">审批</h1>\
                                <h1 class="myheadLabel">查看意见</h1>\
                            </div>\
                        </div>';
        $("#finalJudgement").html(content);
        $("#finalJudgement").show('slow');

        var myurl = "http://202.120.40.73:28080/Entity/Ubfca480238c858/PaperRev/Paper/?Paper.status=FinalJudgement";

        $.ajax({
            url: myurl,
            type: "GET",
            success: function (data) {
                var obj = eval(data);
                var papers = obj.Paper;
                var color = 0;
                for (var i = 0; i < papers.length; i++) {
                    showPaperInfo(papers[i], color, "#finalJudgement");
                    color++;
                }
            }
        });
    }
</script>

<script tpye="text/javascript">
    function checkAdviceClick(data) {
        var paperID = data;
        console.log(paperID);
        var url = "viewAdvice.html?pid="+paperID;
        window.open(url,"","top=150,left=300,width=600,height=400");
    }

    function judgeClick(paperID) {
        var content = '<button type="button" class="btn btn-success btn-lg" onclick="finalJudge('+paperID+',1)">通过</button>\
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\
                        <button type="button" class="btn btn-danger btn-lg" onclick="finalJudge('+paperID+',0)">拒绝</button>';
        $("#FinalJudgeBtn").html(content);
        $("#myModal").modal();
    }

    function finalJudge(paperID,tag) {
        console.log("final");
        console.log(tag);
        var myurl = "http://202.120.40.73:28080/Entity/Ubfca480238c858/PaperRev/Paper/?Paper.id="+paperID;
        $.ajax({
            url: myurl,
            type: "GET",
            success: function (oldpaperdata) {
                var oldPaper = eval(oldpaperdata).Paper[0];
                if (tag == 1) {
                    oldPaper.status = "Passed";
                }
                else {
                    oldPaper.status = "Failed";
                }
                console.log(oldPaper);
                $.ajax({
                    url: "http://202.120.40.73:28080/Entity/Ubfca480238c858/PaperRev/Paper/"+paperID,
                    contentType: "application/json",
                    type: "PUT",
                    data: JSON.stringify(oldPaper),
                    success: function (newpaper) {
                        console.log(eval(newpaper));
                    }
                });

                $("#myModal").modal("hide");

            }
        });

    }

</script>
</body>
</html>