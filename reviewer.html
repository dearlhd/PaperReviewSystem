<!DOCTYPE HTML>
<html>
<head>
    <title>Reviewer</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="keywords" content="Gato Responsive web template, Bootstrap Web Templates, Flat Web Templates, Andriod Compatible web template,
Smartphone Compatible web template, free webdesigns for Nokia, Samsung, LG, SonyErricsson, Motorola web design" />
    <script type="application/x-javascript"> addEventListener("load", function() { setTimeout(hideURLbar, 0); }, false); function hideURLbar(){ window.scrollTo(0,1); } </script>
    <link href="css/bootstrap.css" rel='stylesheet' type='text/css' />
    <!-- Custom Theme files -->
    <link href="css/style.css" rel='stylesheet' type='text/css' />
    <link href="css/myCss.css" rel='stylesheet' type='text/css' />
    <script src="js/jquery-2.2.3.min.js"> </script>
    <script src="js/bootstrap.min.js"> </script>
    <!--webfonts-->
    <link href='http://fonts.useso.com/css?family=Raleway:400,100,200,300,500,600,700|Cinzel+Decorative:400,700' rel='stylesheet' type='text/css'>
    <!--//webfonts-->
</head>
<body>
<!--start-home-->
<div id="home" class="header">
    <div class="header-bottom">
        <div class="container">
            <div class="logo">
                <a href=""><h1>Paper<span>_System</span></h1></a>
            </div>
            <span class="menu"></span>
            <div class="top-menu">
                <ul>
                    <nav>
                        <li><a href="viewPaper.html">查阅论文</a></li>
                        <li><a href="reviewer.html">审稿</a></li>
                        <li><a onclick="logOut();">退出</a></li>
                    </nav>
                </ul>
            </div>

            <!-- script for menu -->
            <div class="clearfix"></div>
        </div>
    </div>

    <div class="banner two">
        <div class="container">
            <div class="pag-nav">
                <ul class="p-list">
                    <li><a href="" class="act">待审阅</a></li> &nbsp;&nbsp;/&nbsp;
                    <li><a href="">已审阅（有更新）</a></li>/&nbsp;
                    <li><a href="">已审阅</a></li>
                </ul>
            </div>
        </div>
    </div>
</div>
<!--error-->

<div class="contact" id="review_content">
    <div class="container">
        <div class="contact-main">
            <h1 class="myheadText" style="font-size:30px">论文名</h1>
            <h1 class="myheadLabel">添加审稿意见</h1>
            <h1 class="myheadLabel">查看意见</h1>
        </div>
    </div>

    <div class="container" style="background: lightgray;">
        <div>
            <h1 class="mytext" value="Paper" onclick="ShowPaperClick(this)">Paper</h1>
            <button class="btn btn-primary btn-lg" style="float:right" onclick="addAdviceClick(this)">添加审稿意见</button>
            <button class="btn btn-primary btn-lg" style="float:right" onclick="checkAdviceClick(this)">查看意见</button>
        </div>
    </div>
</div>

<script type="text/javascript">
    $(document).ready(function(){
        var username=document.cookie.split(";")[0].split("=")[1];
        var role=document.cookie.split(";")[1].split("=")[1];

        var myurl = "http://202.120.40.73:28080/Entity/Ubfca480238c858/PaperRev/User/";
        myurl = myurl + "?User.name="+username;
        //myurl = myurl + "?User.name=rev2";

        $.ajax({
            url: myurl,
            type: "GET",
            success: function (data) {
                var obj = eval(data);
                var papers = obj.User[0].check;
                for (var i = 0; i < papers.length; i++) {
                    showPaperInfo(papers[i], i);
                }
            }
        });
    })

    function showPaperInfo(data, flag) {
        var content = '\
        <div class="modal fade" id="Modal'+data.id+'" tabindex="-1" role="dialog"\
        aria-labelledby="myModalLabel" aria-hidden="true">\
            <div class="modal-dialog">\
                <div class="modal-content">\
                    <div class="modal-header">\
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">x</button>\
                        <h4 class="modal-title" id="myModalLabel">请选择评审意见</h4>\
                    </div>\
                    <div class="modal-body">\
                          <table align="center">\
                              <tr>\
                                <td><label for="name">审稿意见</label></td>\
                                <td><select id="advice'+data.id+'" class="form-control"> \
                                    <option value="Strong Accept">Strong Accept</option>\
                                    <option value="Accept">Accept</option>\
                                    <option value="Weak Accept">Weak Accept</option>\
                                    <option value="Borderline Paper">Borderline Paper</option>\
                                    <option value="Weak Reject">Weak Reject</option>\
                                    <option value="Reject">Reject</option>\
                                    <option value="Strong Reject">Strong Reject</option>\
                                </select></td>\
                              </tr>\
                              <tr>\
                                  <td><label for="name">信任度</label></td>\
                                  <td><select id="confidence'+data.id+'" class="form-control"> \
                                    <option value="Expert">Expert</option>\
                                    <option value="High">High</option>\
                                    <option value="Medium">Medium</option>\
                                    <option value="Low">Low</option>\
                                    <option value="Null">Null</option>\
                                  </select></td>\
                              </tr>\
                          </table>\
                    </div>\
                    <div class="modal-footer">\
                        <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>\
                        <button type="button" class="btn btn-primary" onclick="addAdvice('+data.id+')">提交</button>\
                    </div>\
                </div><!-- /.modal-content -->\
            </div><!-- /.modal-dialog -->\
        </div><!-- /.modal -->';

        if (flag % 2 == 1) {
            content += '\
            <div class="container" style="background: lightgray;">\
                <div>\
                    <h1 class="mytext" value="Paper" onclick="ShowPaperClick(' + data.id + ')">' + data.title + '</h1>\
                    <input type="button" class="mybutton" value="添加审稿意见" onclick="addAdviceClick(' + data.id + ')">\
                    <input type="button" class="mybutton" value="查看意见" onclick="checkAdviceClick(' + data.id + ')">\
                </div>\
            </div>';
        }
        else {
            content += '\
            <div class="container" style="background: lightgray;">\
                <div>\
                    <h1 class="mytext" value="Paper" onclick="ShowPaperClick(' + data.id + ')">' + data.title + '</h1>\
                    <input type="button" class="mybutton" value="添加审稿意见" onclick="addAdviceClick(' + data.id + ')">\
                    <input type="button" class="mybutton" value="查看意见" onclick="checkAdviceClick(' + data.id + ')">\
                </div>\
            </div>';
        }

        $("#review_content").append(content);
    }
</script>

<script tpye="text/javascript">
    function checkAdviceClick(data) {
        var paperID = data;
        console.log(paperID);
        var url = "viewAdvice.html?pid="+paperID;
        window.open(url,"","top=150,left=300,width=600,height=400");
    }

    function addAdviceClick(paperID) {
        $("#Modal"+paperID).modal();
    }

    function addAdvice(paperID) {
        var advice = $("#advice"+paperID).val();
        var confidence = $("#confidence"+paperID).val();

        var username=document.cookie.split(";")[0].split("=")[1];

        var myurl = "http://202.120.40.73:28080/Entity/Ubfca480238c858/PaperRev/User/?User.name="+username;
        var userid;
        $.ajax({
            url: myurl,
            type: "GET",
            success: function (data) {
                var obj = eval(data);
                userid = obj.User[0].id;

                var comment = {
                    "reviewer":username,
                    "advice":advice,
                    "confidence":confidence,
                    "commentwhat":{"id":paperID, "type":"Paper"},
                    "whocomment":{"id":userid, "type":"User"}
                }

                console.log(comment);

                $.ajax({
                    url: "http://202.120.40.73:28080/Entity/Ubfca480238c858/PaperRev/Comment/",
                    contentType: "application/json",
                    type: "POST",
                    data: JSON.stringify(comment),
                    success: function (data) {
                        var obj = eval(data);
                        document.cookie = "name="+uname;
                        window.location.href="contributor.html";
                    }
                });

                $("#Modal"+paperID).modal("hide");

            }
        });


    }

</script>
</body>
</html>